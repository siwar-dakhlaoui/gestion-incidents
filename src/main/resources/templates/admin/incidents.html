<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gestion des incidents</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container-fluid mt-4">

    <h3 class="mb-4">
        <i class="bi bi-exclamation-triangle-fill text-warning"></i>
        Liste de tous les incidents
    </h3>

    <div th:if="${#lists.isEmpty(incidents)}" class="alert alert-info">
        Aucun incident trouvé.
    </div>

    <table th:if="${!#lists.isEmpty(incidents)}"
           class="table table-bordered table-hover align-middle">

        <thead class="table-dark">
        <tr>
            <th>#</th>
            <th>Titre</th>
            <th>Citoyen</th>
            <th>Catégorie</th>
            <th>Statut</th>
            <th>Date</th>
            <th>Photos</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="incident, i : ${incidents}">
            <td th:text="${i.count}"></td>

            <td th:text="${incident.titre}"></td>

            <td th:text="${incident.citoyen.email}"></td>

            <td>
                <span class="badge bg-info"
                      th:text="${incident.categorie}">
                </span>
            </td>

            <td>
                <span class="badge"
                      th:classappend="
                        ${incident.statut.name() == 'SIGNALE'} ? 'bg-warning' :
                        (${incident.statut.name() == 'EN_COURS'} ? 'bg-primary' :
                        'bg-success')"
                      th:text="${incident.statut}">
                </span>
            </td>

            <td th:text="${#temporals.format(incident.dateDeclaration,'dd/MM/yyyy HH:mm')}"></td>

            <td>
                <div th:if="${incident.photos != null}">
                    <a th:each="photo : ${incident.photos}"
                       th:href="@{'/uploads/incidents/' + ${photo}}"
                       target="_blank"
                       class="me-1">
                        <img th:src="@{'/uploads/incidents/' + ${photo}}"
                             width="50"
                             height="50"
                             class="rounded border"/>
                    </a>
                </div>
            </td>
        </tr>
        </tbody>

    </table>

    <a th:href="@{/admin/dashboard}" class="btn btn-secondary mt-3">
        ⬅ Retour au dashboard
    </a>

</div>

</body>
</html>
